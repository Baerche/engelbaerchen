// Generated by CoffeeScript 1.7.1
(function() {
  var lib, mix;

  lib = require('cloud/gen/server-lib');

  mix = exports;

  mix.register = function(run) {
    lib.define_get('/', mix.index, {
      title: "Index",
      main: "gen/logged-in.js"
    });
    if (run) {
      return $(function() {
        return lib.mixes[run]({}, {});
      });
    }
  };

  mix.index = function(req, res) {
    var u;
    u = Parse.User.current();
    if (Parse.User.current()) {
      u.fetch().then((function(u) {
        var args, json;
        json = "Es wird nichts untersucht";
        json = JSON.stringify({
          ajax: lib.ajax,
          clientSide: lib.clientSide
        }, null, 1);
        args = {
          username: u.getUsername(),
          json: json,
          entwurf: u.get("entwurf"),
          bookmarks: u.get("bookmarks"),
          msg: (req.msg ? req.msg : ""),
          pref: lib.appPrefix,
          ajax: lib.ajax
        };
        console.log(args);
        lib.render("logged-in.ejs", args);
        if (lib.clientSide) {
          $(".bookmarks").html(args.bookmarks);
        }
        return true;
      }), function(error) {
        console.error(error);
        lib.render("meldung.ejs", {
          message: "Hier drin ging was kaputt."
        });
      });
    } else {
      lib.redirect("login.html");
    }
  };

}).call(this);
